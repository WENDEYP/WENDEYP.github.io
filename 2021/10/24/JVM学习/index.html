<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>JVM学习 | 秋意已暮，寒冬将至</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="native1234567891011121314151617181920212223242526package com.wu.pojo;public class Demo &amp;#123;    public static void main(String[] args) &amp;#123;        new Thread(()-&gt;&amp;#123;        &amp;#125;,&quot;my th">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM学习">
<meta property="og:url" content="http://example.com/2021/10/24/JVM%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="秋意已暮，寒冬将至">
<meta property="og:description" content="native1234567891011121314151617181920212223242526package com.wu.pojo;public class Demo &amp;#123;    public static void main(String[] args) &amp;#123;        new Thread(()-&gt;&amp;#123;        &amp;#125;,&quot;my th">
<meta property="og:locale">
<meta property="article:published_time" content="2021-10-24T14:50:51.000Z">
<meta property="article:modified_time" content="2021-10-24T14:52:13.928Z">
<meta property="article:tag" content="转发">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="秋意已暮，寒冬将至" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">秋意已暮，寒冬将至</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-JVM学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/24/JVM%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-10-24T14:50:51.000Z" itemprop="datePublished">2021-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      JVM学习
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="native"><a href="#native" class="headerlink" title="native"></a>native</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wu.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;my thread name&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * native : 凡是带了native关键字的，说明java的作用范围达不到了，回去调用底层C语言库！</span></span><br><span class="line"><span class="comment">     * 会进入本地方法栈</span></span><br><span class="line"><span class="comment">     * 调用本地方法本地接口 JNI</span></span><br><span class="line"><span class="comment">     * JNI作用 ： 扩展java使用，会融合不同的语言为java所用！    最初是C语言与C++</span></span><br><span class="line"><span class="comment">     * java诞生时，C与C++横行，想要立足，必须有调用C与C++的程序</span></span><br><span class="line"><span class="comment">     * 它在内存区域中专门开辟了一块标记区域：native Method stack（本地方法栈），登记native方法</span></span><br><span class="line"><span class="comment">     * 在最终执行时加载本地方法库中的方法通过JNI</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * java程序员驱动打印机时要使用native方法，    管理系统，掌握即可，在企业应用组少见</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">Start0</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//调用其他接口：       Socket， WebService， HTTP</span></span><br><span class="line">    <span class="comment">//eg： 球球爱心网： 输入（PHP）--&gt; NodeJS --&gt; Socket --&gt; C++ --&gt; 游戏刷爱心</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>##方法区</p>
<ul>
<li>存放静态变量（static）、常量（final）、类信息（构造方法，接口定义）Class、常量池</li>
</ul>
<p>#栈</p>
<ul>
<li>先进后出，后进先出，如：桶</li>
<li>栈内存，主管程序的运行，生命周期和线程同步；</li>
<li>线程结束，栈内存释放，对于栈来说，不存在垃圾回收，一旦线程结束，栈就Over！</li>
<li>栈存放的东西： 8大基本类型+对象的引用（地址）+实例方法</li>
<li>栈的运行原理：栈帧（百度学习）</li>
<li>栈满了 报错：StackOverFlowError<br>#队列</li>
<li>先进先出（FIFO：first input First output），如排队，管道。<ul>
<li>喝多了吐就是栈</li>
<li>吃多了拉就是队列</li>
</ul>
</li>
</ul>
<p>#堆</p>
<ul>
<li>Heap，一个JVM只有一个堆内存，堆内存的大小可以调节</li>
<li>类加载器读取了类文件后，一般把（类，方法，常量，变量，保存我们所有引用类型的真实对象）</li>
<li>堆内存中分为三个区域<ul>
<li>新生区（伊甸园区，幸存0区，幸存1区）<ul>
<li>类：诞生和成长的地方，甚至死亡；</li>
<li>伊甸园，所有的对象都在伊甸园区new出来</li>
<li>幸存者区（0,1）</li>
</ul>
</li>
<li>养老区 older</li>
<li>永久区 Perm  ：这个区域常驻内存的，用来存放JDK自身携带的Class对象，interface元数据，存放java运行时的一些环境或类信息，这个区域不存在垃圾回收！关闭JVM虚拟就会释放这个区域的内存<ul>
<li>一个启动类，加载了大量的第三方jar包，Tomcat部署了太多的应用，大量动态生成的反射类，不断的被加载，直到内存满，就会出现OOM错误</li>
<li>jdk1.6之前：永久代，常量池是在方法区；</li>
<li>jdk1.7：永久代，但是慢慢退化了，去永久代，常量池在堆中</li>
<li>jdk.8之后：无永久代，常量池在元空间</li>
</ul>
</li>
<li>元空间，逻辑上存在，物理上可能不存在</li>
</ul>
</li>
<li>GC垃圾回收，主要在伊甸园区和养老区，<ul>
<li>内存调优，-Xms1024m -Xmx1024M -XX:+printGCDetails</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wu.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回虚拟机试图使用的最大内存</span></span><br><span class="line">        <span class="keyword">long</span> max = Runtime.getRuntime().maxMemory(); <span class="comment">//字节 1024*1024</span></span><br><span class="line">        <span class="comment">//返回JVM的初始化总内存</span></span><br><span class="line">        <span class="keyword">long</span> total = Runtime.getRuntime().totalMemory();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;max=&quot;</span>+max+<span class="string">&quot;字节\t&quot;</span>+(max/(<span class="keyword">double</span>)<span class="number">1024</span>/<span class="number">1024</span>)+<span class="string">&quot;MB&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;total=&quot;</span>+max+<span class="string">&quot;字节\t&quot;</span>+(total/(<span class="keyword">double</span>)<span class="number">1024</span>/<span class="number">1024</span>)+<span class="string">&quot;MB&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//默认情况下；分配的总内存是电脑内存的1/4，初始化的内存为1/64</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//OOM(内存满报错)</span></span><br><span class="line">        <span class="comment">// 1.尝试扩大堆内存，查看结果（-Xms1024m -Xmx1024m -XX:+PrintGCDetails）</span></span><br><span class="line">        <span class="comment">// 2.分析内存，看下哪个地方出问题（专业工具）</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>堆内存满了报错：OutOfMemoryError</li>
<li>在一个项目中，突然出现了OOM故障，排除问题<ul>
<li>能够看到代码第几行出错：内存快照分析工具：MAT，Jprofiler</li>
<li>Debug，一行一行分析（最慢）</li>
<li>MAT,Jprofiler 作用<ul>
<li>分析Dump内存文件，快速定位内存泄露</li>
<li>获得堆中数据</li>
<li>获得大的对象</li>
<li>Dump文件  -Xms1m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError<ul>
<li>-Xms 设置初始化内存分配大小，默认1/64</li>
<li>-Xmx 设置最大分配内存，默认1/4</li>
<li>-XX:+PrintGCDetails  ,打印GC垃圾回收信息</li>
<li>-XX:+HeapDumpOnOutOfMemoryError</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>#GC(垃圾自动回收)</p>
<ul>
<li><p>JVM进行GC时，并不是对三个区域统一回收，大部分时候回收新生代</p>
</li>
<li><p>GC两种类：轻GC（普通的GC），重GC（全局的GC）</p>
</li>
<li><p>GC的算法：标记清除法，标记压缩，复制算法，引用计数器</p>
</li>
<li><p>每次GC都会讲伊甸园中活的对象移动到幸存区中；且Eden区被GC后，就会是空的</p>
</li>
<li></li>
<li><p>内存效率：复制算法&gt;标记清除算法&gt;标记压缩算法     （时间复杂度）</p>
</li>
<li><p>内存整齐度：复制算法=标记压缩算法&gt;标记清除算法</p>
</li>
<li><p>内存利用率：标记压缩算法=标记清除算法&gt;复制算法</p>
</li>
<li></li>
<li><p>年轻代</p>
<ul>
<li>存活率低</li>
<li>复制算法</li>
</ul>
</li>
<li><p>老年代</p>
<ul>
<li>区域大：存活率低</li>
<li>标记清除（内存碎片不是太多）+标记压缩 混合实</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/24/JVM%E5%AD%A6%E4%B9%A0/" data-id="ckv60pque00007s5x4gi5e6f5" data-title="JVM学习" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E5%8F%91/" rel="tag">转发</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/10/24/%E7%BA%BF%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">线程</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA-%E5%88%86%E4%BA%AB/" rel="tag">-导航 -分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E5%8F%91/" rel="tag">转发</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%AF%BC%E8%88%AA-%E5%88%86%E4%BA%AB/" style="font-size: 10px;">-导航 -分享</a> <a href="/tags/%E8%BD%AC%E5%8F%91/" style="font-size: 10px;">转发</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/24/JVM%E5%AD%A6%E4%B9%A0/">JVM学习</a>
          </li>
        
          <li>
            <a href="/2021/10/24/%E7%BA%BF%E7%A8%8B/">线程</a>
          </li>
        
          <li>
            <a href="/2021/10/24/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 秋意已暮，寒冬将至<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>